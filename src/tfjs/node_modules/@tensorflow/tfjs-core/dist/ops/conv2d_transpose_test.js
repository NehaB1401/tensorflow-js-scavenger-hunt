"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var dl = require("../index");
var test_util_1 = require("../test_util");
test_util_1.describeWithFlags('conv2dTranspose', test_util_1.ALL_ENVS, function () {
    it('input=2x2x1,d2=1,f=2,s=1,p=0', function () {
        var origInputDepth = 1;
        var origOutputDepth = 1;
        var inputShape = [1, 1, origOutputDepth];
        var fSize = 2;
        var origPad = 0;
        var origStride = 1;
        var x = dl.tensor3d([2], inputShape);
        var w = dl.tensor4d([3, 1, 5, 0], [fSize, fSize, origInputDepth, origOutputDepth]);
        var result = dl.conv2dTranspose(x, w, [2, 2, 1], origStride, origPad);
        var expected = [6, 2, 10, 0];
        expect(result.shape).toEqual([2, 2, 1]);
        test_util_1.expectArraysClose(result, expected);
    });
    it('input=2x2x1,d2=1,f=2,s=1,p=0, batch=2', function () {
        var origInputDepth = 1;
        var origOutputDepth = 1;
        var inputShape = [2, 1, 1, origOutputDepth];
        var fSize = 2;
        var origPad = 0;
        var origStride = 1;
        var x = dl.tensor4d([2, 3], inputShape);
        var w = dl.tensor4d([3, 1, 5, 0], [fSize, fSize, origInputDepth, origOutputDepth]);
        var result = dl.conv2dTranspose(x, w, [2, 2, 2, 1], origStride, origPad);
        var expected = [6, 2, 10, 0, 9, 3, 15, 0];
        expect(result.shape).toEqual([2, 2, 2, 1]);
        test_util_1.expectArraysClose(result, expected);
    });
    it('throws when x is not rank 3', function () {
        var origInputDepth = 1;
        var origOutputDepth = 1;
        var fSize = 2;
        var origPad = 0;
        var origStride = 1;
        var x = dl.tensor2d([2, 2], [2, 1]);
        var w = dl.tensor4d([3, 1, 5, 0], [fSize, fSize, origInputDepth, origOutputDepth]);
        expect(function () { return dl.conv2dTranspose(x, w, [2, 2, 1], origStride, origPad); })
            .toThrowError();
    });
    it('throws when weights is not rank 4', function () {
        var origInputDepth = 1;
        var origOutputDepth = 1;
        var inputShape = [1, 1, origOutputDepth];
        var fSize = 2;
        var origPad = 0;
        var origStride = 1;
        var x = dl.tensor3d([2], inputShape);
        var w = dl.tensor3d([3, 1, 5, 0], [fSize, fSize, origInputDepth]);
        expect(function () { return dl.conv2dTranspose(x, w, [2, 2, 1], origStride, origPad); })
            .toThrowError();
    });
    it('throws when x depth does not match weights original output depth', function () {
        var origInputDepth = 1;
        var origOutputDepth = 2;
        var wrongOrigOutputDepth = 3;
        var inputShape = [1, 1, origOutputDepth];
        var fSize = 2;
        var origPad = 0;
        var origStride = 1;
        var x = dl.tensor3d([2, 2], inputShape);
        var w = dl.randomNormal([fSize, fSize, origInputDepth, wrongOrigOutputDepth]);
        expect(function () { return dl.conv2dTranspose(x, w, [2, 2, 2], origStride, origPad); })
            .toThrowError();
    });
});
